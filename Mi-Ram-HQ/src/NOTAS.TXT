#include"proceso3.h"

int comenzar_patota_memoria(t_tareas_cPID *tareas_cPID_recibidas) {

}

void comenzar_patota(int client, t_tareas_cPID *tareas_cPID_recibidas)
{
    //CREO EL REGISTRO DE SEGMENTOS DEL PROCESO
    t_list* registro_segmentos = list_create();

    //CREO LA NUEVA FILA DE LA LISTA DE PROCESOS
    t_registro_procesos *nuevo_proceso;

    //LLENO LA FILA DE LA LISTA DE PROCESOS
    nuevo_proceso->pid    = tareas_cPID_recibidas->pid;
    nuevo_proceso->       = t_registro_procesos;
    nuevo_proceso->indice =

    //AÃ‘ADO LA FILA A LA LISTA DE PROCESOS
    list_add(tabla_procesos, nuevo_proceso);

    //SOLICITO ESPACIO EN MEMORIA PARA GUARDAR EL PCB

    //GUARDO EL PCB EN EL REGISTRO DE SEGMENTOS

    //SOLICITO ESPACIO EN MEMORIA PARA GUARDAR LAS TAREAS
    
    //GUARDO LAS TAREAS EN MEMORIA
    
}
    
/*
    nuevo.pid = pcb->PID;
    nuevo->registros = list_create();
    list_add(tabla_procesos, nuevo);
    
    //LLENAR PCB
    pcb->PID    = tareas_cPID_recibidas->PID;
    //pcb->tareas = (int) tareas_recibidas;

    // Creamos un nuevo registros de datos del proceso
    // Asignamos sus datos
    // Agregamos a la lista de datos del proceso
    registro_datos_proceso nuevo_datos;
    nuevo_datos.segmento = nuevo.indice++; // Asigna y dsps aumenta
    nuevo_datos.base = pcb;
    nuevo_datos.tamanio = sizeof(pcb);
    nuevo_datos.tipo = PCB;
    nuevo_datos.usado = 0;
    list_add(nuevo->registros, nuevo_datos);
    
    // TODO agregar registro de tareas

    // TODO devolver direccion_logica

    direccion_logica direccion_PCB;
    direccion_PCB.base = pcb;
    direccion_PCB.desplazamiento = 0

    //ENVIAR A DISCORDIADOR EL PUNTERO AL PCB
    printf("Enviando datos...\n");
    int tamanioSerializacion;
    void *paquete = serializarDireccionPcb(direccion_PCB, &tamanioSerializacion);
    printf("Se enviaron %d bytes\n\n", send(client, paquete, tamanioSerializacion, 0));
    free(paquete);
}

void iniciar_tripulante(t_TCB* tcb_recibido)
{
    bool buscar_proceso(registro_proceso* proceso) {
        t_PCB* pcb = tcb_recibido->puntero_PCB.base;
        return proceso->pid == pcb->PID;
    }
    
    // Buscamos al proceso que es el creador del hilo
    registro_proceso* proceso = list_find(tabla_procesos, (*buscar_proceso));

    // Creamos un nuevo registros de datos del proceso
    // Asignamos sus datos
    // Agregamos a la lista de datos del proceso
    registro_datos_proceso nuevo_datos;
    nuevo_datos.segmento = nuevo.indice++; // Asigna y dsps aumenta
    nuevo_datos.base = tcb_recibido;
    nuevo_datos.tamanio = sizeof(tcb_recibido);
    nuevo_datos.tipo = TCB;
    nuevo_datos.usado = 0;
    list_add(proceso->registros, nuevo_datos);
}

void listarTripulantes () {
    void mostrar_tripulantes_por_patota(registro_proceso* registro)
    {
        void mostrar_tripulante(registro_datos_proceso* registro)
        {
            printf("TID: %d\nEstado: %c", registro->tid, registro->estado);
        }

        bool esTcb (registro_datos_proceso* data) {
            return registro_datos_proceso->tipo == TCB;
        }

        printf("PID: %d", registro->pid);
        // Filtramos de la sublista los registros que solo sean tcbs
        t_list* tcbs = list_filter(registro->registros, (*esTcb));
        // Recorremos la lista filtrada mostrando los datos del tripulante
        list_iterate(tcbs, (*mostrar_tripulante))
    }

    // Recorremos la lista y aplicamos la funcion a cada valor de cada pos
    list_iterate(tabla_procesos, (*mostrar_tripulantes_por_patota))
}
*/

